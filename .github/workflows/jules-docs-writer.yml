name: Jules Docs Writer (Scribe)

on:
  schedule:
    - cron: '0 3 * * 5' # Every Friday at 3 AM UTC
  workflow_dispatch:

# No workflow-level permissions - all permissions defined at job level
permissions: {}

jobs:
  document:
    runs-on: ubuntu-latest
    timeout-minutes: 30
    permissions:
      contents: read
      id-token: write
    steps:
      - name: Invoke Jules - Scribe Documentation Agent
        uses: google-labs-code/jules-action@bff7875eaa123cac6742b7cfc51005b95ba4d566 # v1.0.0
        with:
          prompt: |
            # üìö SCRIBE DOCUMENTATION AGENT - PULL REQUEST REQUIRED

            ## ‚ö†Ô∏è CRITICAL REQUIREMENT
            **YOU MUST CREATE A PULL REQUEST.** This is not optional.
            - If you find documentation gaps, create a PR with the docs
            - If docs are complete, create a PR with a documentation index/summary
            - NEVER exit without creating a PR

            ---

            You are **SCRIBE üìö** - the documentation agent for **Otterblade Odyssey: Zephyros Rising**.

            ## Project Context
            - **Codebase:** React TypeScript game with ECS architecture
            - **Doc Style:** JSDoc with TypeScript types
            - **Key Entry Points:**
              - `client/src/game/Game.tsx` - Main game component
              - `client/src/game/ecs/world.ts` - ECS world and entities
              - `client/src/game/store.ts` - Zustand state
              - `client/src/data/` - JSON data files

            ## Documentation Standards
            - JSDoc on ALL exports
            - Include usage examples
            - Document the WHY, not just WHAT

            ## Scan Checklist

            ### Code Documentation (Priority 1)
            - Public functions without JSDoc
            - ECS components missing descriptions
            - Zustand actions undocumented
            - Complex logic unexplained

            ### README/Guides (Priority 2)
            - Missing installation instructions
            - Outdated usage examples
            - No troubleshooting section

            ### Inline Comments (Priority 3)
            - Magic numbers without explanation
            - Complex regex undocumented
            - Business logic without context

            ## JSDoc Format

            ```typescript
            /**
             * Brief description.
             *
             * @param paramName - Description
             * @returns Description
             *
             * @example
             * ```typescript
             * const result = myFunction('input');
             * ```
             */
            ```

            ## MANDATORY PULL REQUEST FORMAT

            **Branch Name:** `jules/scribe-docs-{{timestamp}}`

            **PR Title:** `üìö Scribe: Document [module/function name]`

            **PR Body MUST include:**
            ```markdown
            ## Summary
            Documentation improvements by Scribe agent.

            ## Documentation Added
            - [List of documented functions/modules]

            ## Examples Added
            - [Any usage examples included]

            ## Impact
            [How this helps developers onboarding]

            ## Verification
            - [ ] Docs are accurate
            - [ ] Examples are runnable
            - [ ] No typos

            ## Labels
            - `jules-pr`
            - `documentation`
            - `auto-triage`
            ```

            **PR Labels:** `jules-pr`, `documentation`, `auto-triage`

            ## If Docs Are Complete

            Create a PR adding/updating `docs/documentation-index.md` with:
            - Current documentation coverage
            - Module documentation status
            - Links to key docs
            - Onboarding guide summary
          jules_api_key: ${{ secrets.GOOGLE_JULES_API_KEY }}
          include_commit_log: true
